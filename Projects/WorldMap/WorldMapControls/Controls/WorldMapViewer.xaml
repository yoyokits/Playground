<Grid
    x:Class="WorldMapControls.Controls.WorldMapViewer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="450"
    d:DesignWidth="800"
    Background="#141414"
    Loaded="Window_Loaded"
    mc:Ignorable="d">
    <Grid.Resources>
        <SolidColorBrush x:Key="ColorMapItemTextBg" Color="#262626" />
        
        <!-- Color Picker Button Style -->
        <Style x:Key="ColorPickerButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="24" />
            <Setter Property="Margin" Value="0,0,4,0" />
            <Setter Property="Background" Value="#1E1E1E" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="#555" BorderThickness="1" CornerRadius="3">
                            <Rectangle x:Name="ColorPreview" Margin="2" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#777" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="BorderBrush" Value="#999" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="ComboBoxItem" x:Key="ColorMapItemContainerStyle">
            <Setter Property="Padding" Value="2" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="#F5F5F5" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#333333" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#3E5D90" />
                    <Setter Property="Foreground" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <DataTemplate x:Key="ColorMapItemTemplate">
            <DockPanel LastChildFill="True" Margin="2,1">
                <Border Width="80" Height="14" CornerRadius="2" Margin="0,0,6,0" Background="{Binding Brush}" />
                <Border Background="{StaticResource ColorMapItemTextBg}" CornerRadius="3" Padding="4,1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Name}" Foreground="#FFFFFF" FontSize="12" FontWeight="SemiBold" />
                </Border>
            </DockPanel>
        </DataTemplate>
    </Grid.Resources>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition />
        <RowDefinition Height="30" />
    </Grid.RowDefinitions>
    <Border Grid.Row="0" Background="#1E1E1E" BorderBrush="#2D2D2D" BorderThickness="0,0,0,1" Padding="8,4">
        <DockPanel LastChildFill="True">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                <TextBlock Text="Color Map:" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" Margin="0,0,8,0" />
                <ComboBox x:Name="ColorMapCombo"
                          Width="220"
                          ItemTemplate="{StaticResource ColorMapItemTemplate}"
                          ItemContainerStyle="{StaticResource ColorMapItemContainerStyle}"
                          SelectionChanged="ColorMapCombo_SelectionChanged"
                          Background="{StaticResource CardBg}"
                          Foreground="#FFFFFF"
                          BorderBrush="#555"
                          Padding="2"
                          HorizontalContentAlignment="Stretch" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="Outline:" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" Margin="0,0,4,0" />
                <Slider x:Name="OutlineSlider" Width="140" Value="1.0" Minimum="0.0" Maximum="5.0" SmallChange="0.1" LargeChange="0.5" IsSnapToTickEnabled="False" AutoToolTipPlacement="TopLeft" AutoToolTipPrecision="1" ValueChanged="OutlineSlider_ValueChanged" Loaded="OutlineSlider_Loaded" Style="{x:Null}" />
                <TextBlock x:Name="OutlineValueText" Width="36" Margin="4,0,0,0" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" Text="1.0" />
                <TextBlock Text="Color:" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" Margin="16,0,4,0" />
                <Button x:Name="OutlineColorPicker" 
                        Style="{StaticResource ColorPickerButtonStyle}"
                        Click="OutlineColorPicker_Click" 
                        ToolTip="Click to change outline color" />
                <TextBlock Text="Fill:" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" Margin="16,0,4,0" />
                <Button x:Name="DefaultFillColorPicker" 
                        Style="{StaticResource ColorPickerButtonStyle}"
                        Click="DefaultFillColorPicker_Click" 
                        ToolTip="Click to change default fill color" />
            </StackPanel>
        </DockPanel>
    </Border>
    <Grid x:Name="MapViewport" Grid.Row="1" Background="#141414" ClipToBounds="True" SizeChanged="MapViewport_SizeChanged" MouseLeave="MapViewport_MouseLeave">
        <Canvas x:Name="MapCanvas" Width="2000" Height="1200" Background="#141414" RenderTransformOrigin="0 0">
            <Canvas.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="ScaleTx" ScaleX="0.55" ScaleY="0.55" />
                    <TranslateTransform x:Name="TranslateTx" X="0" Y="0" />
                </TransformGroup>
            </Canvas.RenderTransform>
        </Canvas>
        <!-- Bottom-left legend panel -->
        <Border HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="10" CornerRadius="8" Background="#FFFFFFFF" Opacity="0.93" BorderBrush="#DDDDDD" BorderThickness="1" Padding="8">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock x:Name="LegendMinText" Text="0" Foreground="#222" VerticalAlignment="Center" Margin="0,0,4,0" />
                <Border Width="220" Height="18" CornerRadius="4" BorderBrush="#CCC" BorderThickness="1" Background="#F2F2F2" Margin="0,0,4,0">
                    <Grid ClipToBounds="True">
                        <Rectangle x:Name="LegendGradient" Width="220" Height="18" RadiusX="3" RadiusY="3" />
                        <Canvas x:Name="LegendTicks" IsHitTestVisible="False" />
                    </Grid>
                </Border>
                <TextBlock x:Name="LegendMaxText" Text="100" Foreground="#222" VerticalAlignment="Center" />
            </StackPanel>
        </Border>
    </Grid>
    <StatusBar Grid.Row="2" Background="#1E1E1E" BorderBrush="#2D2D2D" BorderThickness="0,1,0,0" Foreground="{StaticResource TextSecondaryDark}">
        <StatusBarItem>
            <TextBlock x:Name="StatusText" Margin="5,0" Text="Ready" Foreground="{StaticResource TextSecondaryDark}" />
        </StatusBarItem>
        <StatusBarItem HorizontalAlignment="Right">
            <StackPanel Orientation="Horizontal">
                <TextBlock Margin="5,0,0,0" Text="Zoom:" Foreground="{StaticResource TextSecondaryDark}" />
                <TextBlock x:Name="ZoomText" Margin="4,0,10,0" Text="55%" Foreground="{StaticResource TextPrimary}" />
            </StackPanel>
        </StatusBarItem>
    </StatusBar>
</Grid>